services:
  opencode:
    build: ../../opencode
    image: sparkplay-opencode:local
    container_name: opencode-service
    command: serve --port 4096 --hostname 0.0.0.0
    working_dir: /workspace
    ports:
      - "4096:4096"
    volumes:
      - ./workspace:/workspace # 代码与图片保存路径，此处挂载项目的工作区
      - ../../opencode/opencode.json:/workspace/opencode.json:ro
      - ../../opencode/.opencode:/workspace/.opencode
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - OPENCODE_CONFIG=/workspace/opencode.json
      - OPENCODE_CONFIG_PATH=/workspace/opencode.json
      - API_SERVICE_API_KEY=${API_SERVICE_API_KEY:-123456}
      - MINIMAX_API_KEY=${MINIMAX_API_KEY:-}
    
      - SPARKX_API_BASE_URL=${SPARKX_API_BASE_URL:-https://host.docker.internal:8890}
    restart: unless-stopped
